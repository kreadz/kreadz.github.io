<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com"><h2 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">复现环境</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器">Ubuntu 20.04</p>
<p data-tool="mdnice编辑器">CPU: 32G</p>
<p data-tool="mdnice编辑器">GPU: 11G 2080ti</p>
<p data-tool="mdnice编辑器">Source2slice: clang-6.0 + llvm + dg (dg: https://github.com/mchalupa/dg)、gcc-9.5,g++-9.5</p>
<p data-tool="mdnice编辑器">Data preprocess and Model training: python3.6 + tensorflow1.6 + keras2.1.2 + gensim3.4</p>
<p data-tool="mdnice编辑器">建议用conda配置环境，包括cuda9.0,cudnn7.3,tensorflow-gpu-base-1.6(安装pytorch1.1.0会一起安装)，nvidia driver-535</p>
<h2 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">1.  llvm,clang-6.0安装</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器">参考：https://askubuntu.com/questions/1058534/installing-clang-6-0-on-ubuntu-18-04-lts-bionic</p>
<pre class="custom" data-tool="mdnice编辑器"><code class="hljs">wget&nbsp;-O&nbsp;-&nbsp;https://apt.llvm.org/llvm-snapshot.gpg.key&nbsp;|&nbsp;sudo&nbsp;apt-key&nbsp;add&nbsp;-<br><br>sudo&nbsp;apt-add-repository&nbsp;<span class="hljs-string">"deb&nbsp;http://apt.llvm.org/bionic/&nbsp;llvm-toolchain-bionic-6.0&nbsp;main"</span><br><br>sudo&nbsp;apt&nbsp;update&nbsp;&amp;&amp;&nbsp;sudo&nbsp;apt&nbsp;install&nbsp;clang-6.0<br></code></pre>
<p data-tool="mdnice编辑器">安装失败无果再考虑源码编译安装（并不容易），安装成功直接跳过下一节</p>
<h3 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">ubuntu clang6.0源代码编译安装</span><span class="suffix"></span></h3>
<h4 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">文件资源下载</span><span class="suffix"></span></h4>
<p data-tool="mdnice编辑器">安装总共需要三个tar包，将其全部拖入到Linux环境下。其中cfe-6.0.0.src.tar.xz是clang的源码，compiler-rt-6.0.0.src.tar.xz是动态测试工具，llvm-6.0.0.src.tar是llvm的源码
<img src="https://img-blog.csdnimg.cn/20200705222642102.png" alt=""></p>
<pre class="custom" data-tool="mdnice编辑器"><code class="hljs">curl&nbsp;-L&nbsp;-C&nbsp;-&nbsp;"https://d.pcs.baidu.com/file/ca2f32029rb0f579d86a18435f3b612a?fid=3580935171-250528-214634233489673&amp;dstime=1710208818&amp;rt=sh&amp;sign=FDtAERVJouK-DCb740ccc5511e5e8fedcff06b081203-0EsKsUXkXhEWjG9fPhnStkiYz%2Bw%3D&amp;expires=8h&amp;chkv=1&amp;chkbd=0&amp;chkpc=&amp;dp-logid=503437474518640837&amp;dp-callid=0&amp;shareid=3950100901&amp;r=731328302&amp;resvsflag=1-12-0-1-1-1&amp;vuk=3360598225&amp;file_type=0"&nbsp;-o&nbsp;"cfe-6.0.0.src.tar.xz"&nbsp;-A&nbsp;"pan.baidu.com"&nbsp;-b&nbsp;"BDUSS=FZXR2xPaWdwVlRKZXktbUlTVThWVFRHZGRFdjRaUXFVYUFKby1DSVpzTFM3N1ZsRVFBQUFBJCQAAAAAAAAAAAEAAADmyA5KUWlxaV9DbGlmZgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANJijmXSYo5lN"<br>curl&nbsp;-L&nbsp;-C&nbsp;-&nbsp;"https://d.pcs.baidu.com/file/959617e93jc8a5079ca676a1dbd64b49?fid=3580935171-250528-711933849979721&amp;dstime=1710208818&amp;rt=sh&amp;sign=FDtAERVJouK-DCb740ccc5511e5e8fedcff06b081203-zYRnYqUenQ4cpO%2B%2BMLMzIZOBxao%3D&amp;expires=8h&amp;chkv=1&amp;chkbd=0&amp;chkpc=&amp;dp-logid=503437474518640837&amp;dp-callid=0&amp;shareid=3950100901&amp;r=502521574&amp;resvsflag=1-12-0-1-1-1&amp;vuk=3360598225&amp;file_type=0"&nbsp;-o&nbsp;"compiler-rt-6.0.0.src.tar.xz"&nbsp;-A&nbsp;"pan.baidu.com"&nbsp;-b&nbsp;"BDUSS=FZXR2xPaWdwVlRKZXktbUlTVThWVFRHZGRFdjRaUXFVYUFKby1DSVpzTFM3N1ZsRVFBQUFBJCQAAAAAAAAAAAEAAADmyA5KUWlxaV9DbGlmZgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANJijmXSYo5lN"<br>curl&nbsp;-L&nbsp;-C&nbsp;-&nbsp;"https://d.pcs.baidu.com/file/6532a5a6en72a72e58bae082b68ccca4?fid=3580935171-250528-783078331849335&amp;dstime=1710208818&amp;rt=sh&amp;sign=FDtAERVJouK-DCb740ccc5511e5e8fedcff06b081203-%2BpKHwQMhRNXZhmFxLpGalRO0gw4%3D&amp;expires=8h&amp;chkv=1&amp;chkbd=0&amp;chkpc=&amp;dp-logid=503437474518640837&amp;dp-callid=0&amp;shareid=3950100901&amp;r=109145561&amp;resvsflag=1-12-0-1-1-1&amp;vuk=3360598225&amp;file_type=0"&nbsp;-o&nbsp;"llvm-6.0.0.src.tar"&nbsp;-A&nbsp;"pan.baidu.com"&nbsp;-b&nbsp;"BDUSS=FZXR2xPaWdwVlRKZXktbUlTVThWVFRHZGRFdjRaUXFVYUFKby1DSVpzTFM3N1ZsRVFBQUFBJCQAAAAAAAAAAAEAAADmyA5KUWlxaV9DbGlmZgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANJijmXSYo5lN"<br><span class="hljs-meta"><br>#</span><span class="bash">&nbsp;下载链接：https://pan.baidu.com/s/1pGTDJd7rGxD5vIxChNPP3Q</span><br><span class="hljs-meta">#</span><span class="bash">&nbsp;提取码：cbm1</span><br></code></pre>
<h3 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">安装clang-6.0</span><span class="suffix"></span></h3>
<p data-tool="mdnice编辑器">参考：https://blog.csdn.net/qq_42570601/article/details/107146407</p>
<h4 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">1解压llvm-6.0.0.src.tar</span><span class="suffix"></span></h4>
<p data-tool="mdnice编辑器">在root权限的根目录下，创建一个名为llvmtest目录：
将llvm-6.0.0.src.tar移到llvmtest目录下，使用tar -xvf llvm-6.0.0.src.tar命令解压文件到当前目录，并将解压好的文件重命名为llvm</p>
<h4 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">2解压cfe-6.0.0.src.tar.xz</span><span class="suffix"></span></h4>
<p data-tool="mdnice编辑器">步骤1.1中被解压出来命名为llvm的文件下有一个tools目录，将cfe-6.0.0.src.tar.xz移到其中，使用tar -xvf cfe-6.0.0.src.tar.xz解压，并将解压后的文件重命名为clang</p>
<h4 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">3解压compiler-rt-6.0.0.src.tar.xz</span><span class="suffix"></span></h4>
<p data-tool="mdnice编辑器">步骤1.1中被解压出来命名为llvm的文件下有一个projects目录，将compiler-rt-6.0.0.src.tar.xz移动到其中，使用tar -xvf compiler-rt-6.0.0.src.tar.xz命令解压，并重命名为compiler-rt</p>
<h4 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">编译安装</span><span class="suffix"></span></h4>
<p data-tool="mdnice编辑器">确保你的Linux中有安装cmake。输入cmake -version指令，查看你本机cmake的版本号
没有的话就安装，3.15验证可行
wget https://cmake.org/files/v3.15/cmake-3.15.1.tar.gz
然后参考下面链接完成安装即可：
https://www.cnblogs.com/cxscode/p/10980101.html</p>
<p data-tool="mdnice编辑器">确保已经安装gcc和g++
tar -xvzf cmake-3.6.1.tar.gz
cd cmake-3.6.1/</p>
<p data-tool="mdnice编辑器">然后执行安装过程</p>
<p data-tool="mdnice编辑器">./bootstrap</p>
<p data-tool="mdnice编辑器">执行完之后，一般就是执行make编译，但是根据命令行的提示是接下来请运行gmake，所以应该执行下面命令编译并安装：</p>
<p data-tool="mdnice编辑器">gmake
gmake install</p>
<p data-tool="mdnice编辑器">正式编译安装llvm
在步骤1.1中被解压出来命名为llvm的文件下新建一个名为llvm-build的目录，然后cd到该目录下，输入下面指令对llvm源码进行编译：
cmake -G "Unix Makefiles" -DLLVM_ENABLE_ASSERTIONS=On -DCMAKE_BUILD_TYPE=Release ../</p>
<p data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/5145bc22-1931-4f53-ab3a-bfac72425ff2.png" alt="">
编译完成后输入make install指令进行安装，这个过程比较久，可能要两三个小时；</p>
<h2 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">2. SARD files</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器">(1). getVulLineForCounting.py</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器">
<p>python getVulLineForCounting.py ../../000 ../../xxx.xml</p>
</blockquote>
<p data-tool="mdnice编辑器">This file is used to get the line numbers of vulnerable lines in the source code file. The input is the source code file and xxx.xml file. The output is xxx.txt file, which is renamed as SARD-hole_line.txt.</p>
<p data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/d332681d-a955-4cc3-9799-fe8e4c541d4e.png" alt="">
就是从xml文件中定位到漏洞的具体行数。</p>
<p data-tool="mdnice编辑器">(2). multiFileCompile.py</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器">
<p>python multiFileCompile.py ../../000/ ../../xxx.xml</p>
</blockquote>
<p data-tool="mdnice编辑器">跑之前需要注意，multiFileCompile.py中构造编译命令的代码如下：</p>
<pre class="custom" data-tool="mdnice编辑器"><code class="hljs">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;noFlawFile.endswith(<span class="hljs-string">'.c'</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd1&nbsp;=&nbsp;<span class="hljs-string">'clang&nbsp;-emit-llvm&nbsp;-w&nbsp;-g&nbsp;-c&nbsp;'</span>&nbsp;+&nbsp;os.path.join(rawPathHead,noFlawFile)&nbsp;+&nbsp;<span class="hljs-string">'&nbsp;-o&nbsp;'</span>&nbsp;+&nbsp;os.path.join(rawPathHead,noFlawFile)[:<span class="hljs-number">-2</span>]&nbsp;+&nbsp;<span class="hljs-string">'.bc'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd1&nbsp;+=&nbsp;<span class="hljs-string">'&nbsp;-I&nbsp;/home/king/aproSARD/testcaseLib/'</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">elif</span>&nbsp;noFlawFile.endswith(<span class="hljs-string">'.cpp'</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd1&nbsp;=&nbsp;<span class="hljs-string">'clang++&nbsp;-emit-llvm&nbsp;-w&nbsp;-g&nbsp;-c&nbsp;'</span>&nbsp;+&nbsp;os.path.join(rawPathHead,noFlawFile)&nbsp;+&nbsp;<span class="hljs-string">'&nbsp;-o&nbsp;'</span>&nbsp;+&nbsp;os.path.join(rawPathHead,noFlawFile)[:<span class="hljs-number">-4</span>]&nbsp;+&nbsp;<span class="hljs-string">'.bc'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmd1&nbsp;+=&nbsp;<span class="hljs-string">'&nbsp;-I&nbsp;/home/king/aproSARD/testcaseLib/'</span><br></code></pre>
<ul data-tool="mdnice编辑器">
<li><section>1.上面的clang和clang++我安装的时候是clang-6.0和clang++-6.0,所以要和源码统一。</section></li><li><section>2.还有头文件<strong>std_testcase.h</strong>,代码中是作者的绝对路径，需要改成自己的。</section></li><li><section>3.作者构造cmd的时候字符串用的单引号，注意将synthetic and academic programs改为synthetic_and_academic_programs</section></li></ul>
<p data-tool="mdnice编辑器">This file is used to compile the source code file to .bc file.</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/4a885c4b-5eb5-44c0-b9ab-1264770812d8.png" alt=""></figure>
<p data-tool="mdnice编辑器">使用clang6.0和clang++-6.0将000/下的c文件都编译成.bc文件，.bc 文件是 LLVM 项目中使用的中间表示文件，它们包含了从源代码生成的低级、平台无关的代码。
这个过程我在虚拟机上跑了17分钟。</p>
<p data-tool="mdnice编辑器">(3). get-llvmwithline.cpp</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器">
<p>./get-llvmwithline SARD-hole_line.txt</p>
</blockquote>
<p data-tool="mdnice编辑器">This file is used to extract four kinds of focuses. The output file is in the directory of "000".</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/a1b05522-0907-4333-9983-491b2e6f1b92.png" alt=""></figure>
<p data-tool="mdnice编辑器">可能会遇到ubuntu 缺少 libtinfo.so.5 问题</p>
<pre class="custom" data-tool="mdnice编辑器"><code class="hljs">sudo&nbsp;apt-get&nbsp;install&nbsp;libncurses5<br></code></pre>
<p data-tool="mdnice编辑器">然后就等待他跑完，放一段单个文件的中间输出：</p>
<pre class="custom" data-tool="mdnice编辑器"><code class="hljs">/home/key/Work/2024/VulDeeLocator/data_pre/data_pre_proces/synthetic_and_academic_programs/000/080/513/CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34.c//输出文件名称是我修改了get-llvmwithline.cpp文件.<br>./llvm-slicer&nbsp;-c&nbsp;71:data,124:data,129:data,152:data,154:data,154:data&nbsp;-entry&nbsp;CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34_bad&nbsp;-annotate&nbsp;slicer&nbsp;/home/key/Work/2024/VulDeeLocator/data_pre/data_pre_proces/synthetic_and_academic_programs/000/080/513/CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34.bc<br>Matched&nbsp;line&nbsp;71&nbsp;with&nbsp;variable&nbsp;data&nbsp;to:<br>&nbsp;&nbsp;store&nbsp;i8*&nbsp;%12,&nbsp;i8**&nbsp;%1,&nbsp;align&nbsp;8,&nbsp;!dbg&nbsp;!81<br>Matched&nbsp;line&nbsp;124&nbsp;with&nbsp;variable&nbsp;data&nbsp;to:<br><span class="hljs-meta">&nbsp;&nbsp;%</span><span class="bash">68&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%1,&nbsp;align&nbsp;8,&nbsp;!dbg&nbsp;!187</span><br>Matched&nbsp;line&nbsp;129&nbsp;with&nbsp;variable&nbsp;data&nbsp;to:<br><span class="hljs-meta">&nbsp;&nbsp;%</span><span class="bash">75&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%1,&nbsp;align&nbsp;8,&nbsp;!dbg&nbsp;!197</span><br>Matched&nbsp;line&nbsp;152&nbsp;with&nbsp;variable&nbsp;data&nbsp;to:<br><span class="hljs-meta">&nbsp;&nbsp;%</span><span class="bash">95&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%1,&nbsp;align&nbsp;8,&nbsp;!dbg&nbsp;!227</span><br>Matched&nbsp;line&nbsp;154&nbsp;with&nbsp;variable&nbsp;data&nbsp;to:<br><span class="hljs-meta">&nbsp;&nbsp;%</span><span class="bash">97&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%10,&nbsp;align&nbsp;8,&nbsp;!dbg&nbsp;!231</span><br>Matched&nbsp;line&nbsp;154&nbsp;with&nbsp;variable&nbsp;data&nbsp;to:<br><span class="hljs-meta">&nbsp;&nbsp;%</span><span class="bash">98&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%10,&nbsp;align&nbsp;8,&nbsp;!dbg&nbsp;!232</span><br>[llvm-slicer]&nbsp;CPU&nbsp;time&nbsp;of&nbsp;pointer&nbsp;analysis:&nbsp;3.329000e-03&nbsp;s<br>[llvm-slicer]&nbsp;CPU&nbsp;time&nbsp;of&nbsp;reaching&nbsp;definitions&nbsp;analysis:&nbsp;4.249000e-03&nbsp;s<br>[llvm-slicer]&nbsp;CPU&nbsp;time&nbsp;of&nbsp;control&nbsp;dependence&nbsp;analysis:&nbsp;2.780000e-04&nbsp;s<br>[llvm-slicer]&nbsp;Finding&nbsp;dependent&nbsp;nodes&nbsp;took&nbsp;0&nbsp;sec&nbsp;0&nbsp;ms<br>[llvm-slicer]&nbsp;Saving&nbsp;IR&nbsp;with&nbsp;annotations&nbsp;to&nbsp;/home/key/Work/2024/VulDeeLocator/data_pre/data_pre_proces/synthetic_and_academic_programs/000/080/513/CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34-debug.ll<br>[llvm-slicer]&nbsp;Slicing&nbsp;dependence&nbsp;graph&nbsp;took&nbsp;0&nbsp;sec&nbsp;0&nbsp;ms<br>[llvm-slicer]&nbsp;Sliced&nbsp;away&nbsp;57&nbsp;from&nbsp;151&nbsp;nodes&nbsp;in&nbsp;DG<br>[llvm-slicer]&nbsp;saving&nbsp;sliced&nbsp;module&nbsp;to:&nbsp;/home/key/Work/2024/VulDeeLocator/data_pre/data_pre_proces/synthetic_and_academic_programs/000/080/513/CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34.sliced<br><br>holefuncname:&nbsp;CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34_bad<br>funcname:badVaSink<br><br>·································<br><br><br>./llvm-slicer&nbsp;-c&nbsp;237:service,237:service,241:service,241:service&nbsp;-entry&nbsp;goodB2G&nbsp;-annotate&nbsp;slicer&nbsp;/home/key/Work/2024/VulDeeLocator/data_pre/data_pre_proces/synthetic_and_academic_programs/000/080/513/CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34.bc<br>Did&nbsp;not&nbsp;find&nbsp;slicing&nbsp;criteria:&nbsp;'237:service,237:service,241:service,241:service'<br>[llvm-slicer]&nbsp;CPU&nbsp;time&nbsp;of&nbsp;pointer&nbsp;analysis:&nbsp;4.581000e-03&nbsp;s<br>[llvm-slicer]&nbsp;CPU&nbsp;time&nbsp;of&nbsp;reaching&nbsp;definitions&nbsp;analysis:&nbsp;4.114000e-03&nbsp;s<br>[llvm-slicer]&nbsp;CPU&nbsp;time&nbsp;of&nbsp;control&nbsp;dependence&nbsp;analysis:&nbsp;2.430000e-04&nbsp;s<br>[llvm-slicer]&nbsp;Saving&nbsp;IR&nbsp;with&nbsp;annotations&nbsp;to&nbsp;/home/key/Work/2024/VulDeeLocator/data_pre/data_pre_proces/synthetic_and_academic_programs/000/080/513/CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34-debug.ll<br>[llvm-slicer]&nbsp;saving&nbsp;sliced&nbsp;module&nbsp;to:&nbsp;/home/key/Work/2024/VulDeeLocator/data_pre/data_pre_proces/synthetic_and_academic_programs/000/080/513/CWE134_Uncontrolled_Format_String__char_listen_socket_w32_vsnprintf_34.sliced<br><br>holefuncname:&nbsp;goodB2G<br>funcname:badVaSink<br><br><br>api&nbsp;over<br></code></pre>
<p data-tool="mdnice编辑器">执行完毕</p>
<p data-tool="mdnice编辑器">让GPT为我们解答一下：</p>
<pre class="custom" data-tool="mdnice编辑器"><code class="hljs">;&nbsp;定义一个名为&nbsp;CWE121_Stack_Based_Buffer_Overflow__CWE805_char_alloca_memcpy_32_bad&nbsp;的函数，<br>;&nbsp;该函数模拟了一个栈基础的缓冲区溢出漏洞。<br>define&nbsp;void&nbsp;@CWE121_Stack_Based_Buffer_Overflow__CWE805_char_alloca_memcpy_32_bad()&nbsp;<span class="hljs-comment">#0&nbsp;!dbg&nbsp;!11&nbsp;{</span><br>&nbsp;&nbsp;;&nbsp;在栈上分配一个指针的空间（<span class="hljs-number">8</span>字节对齐）<br>&nbsp;&nbsp;%<span class="hljs-number">1</span>&nbsp;=&nbsp;alloca&nbsp;i8*,&nbsp;align&nbsp;<span class="hljs-number">8</span><br>&nbsp;&nbsp;;&nbsp;在栈上分配另一个指针的空间（<span class="hljs-number">8</span>字节对齐）<br>&nbsp;&nbsp;%<span class="hljs-number">2</span>&nbsp;=&nbsp;alloca&nbsp;i8**,&nbsp;align&nbsp;<span class="hljs-number">8</span><br>&nbsp;&nbsp;;&nbsp;在栈上分配另一个指针的空间（<span class="hljs-number">8</span>字节对齐）<br>&nbsp;&nbsp;%<span class="hljs-number">3</span>&nbsp;=&nbsp;alloca&nbsp;i8**,&nbsp;align&nbsp;<span class="hljs-number">8</span><br>&nbsp;&nbsp;;&nbsp;在栈上分配一个指针的空间（<span class="hljs-number">8</span>字节对齐）<br>&nbsp;&nbsp;%<span class="hljs-number">4</span>&nbsp;=&nbsp;alloca&nbsp;i8*,&nbsp;align&nbsp;<span class="hljs-number">8</span><br>&nbsp;&nbsp;;&nbsp;在栈上分配一个大小为<span class="hljs-number">100</span>字节的数组的空间（<span class="hljs-number">16</span>字节对齐）<br>&nbsp;&nbsp;%<span class="hljs-number">8</span>&nbsp;=&nbsp;alloca&nbsp;[<span class="hljs-number">100</span>&nbsp;x&nbsp;i8],&nbsp;align&nbsp;<span class="hljs-number">16</span><br>&nbsp;&nbsp;;&nbsp;将数组的地址存储到为其分配的指针中（%<span class="hljs-number">9</span>）<br>&nbsp;&nbsp;%<span class="hljs-number">9</span>&nbsp;=&nbsp;alloca&nbsp;i8,&nbsp;i64&nbsp;<span class="hljs-number">50</span>,&nbsp;align&nbsp;<span class="hljs-number">16</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">23</span><br>&nbsp;&nbsp;store&nbsp;i8*&nbsp;%<span class="hljs-number">9</span>,&nbsp;i8**&nbsp;%<span class="hljs-number">4</span>,&nbsp;align&nbsp;<span class="hljs-number">8</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">22</span><br><br>&nbsp;&nbsp;;&nbsp;加载&nbsp;%<span class="hljs-number">4</span>&nbsp;指针指向的地址到新指针中（%<span class="hljs-number">13</span>），准备进行&nbsp;memcpy&nbsp;操作<br>&nbsp;&nbsp;%<span class="hljs-number">13</span>&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%<span class="hljs-number">4</span>,&nbsp;align&nbsp;<span class="hljs-number">8</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">32</span><br>&nbsp;&nbsp;;&nbsp;将加载的地址存储到用于&nbsp;memcpy&nbsp;操作的指针中（%<span class="hljs-number">6</span>）<br>&nbsp;&nbsp;store&nbsp;i8*&nbsp;%<span class="hljs-number">13</span>,&nbsp;i8**&nbsp;%<span class="hljs-number">6</span>,&nbsp;align&nbsp;<span class="hljs-number">8</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">33</span><br><br>&nbsp;&nbsp;;&nbsp;加载&nbsp;%<span class="hljs-number">2</span>&nbsp;指针指向的地址到&nbsp;%<span class="hljs-number">17</span>，并将未初始化的指针存储到&nbsp;%<span class="hljs-number">7</span>&nbsp;中<br>&nbsp;&nbsp;%<span class="hljs-number">17</span>&nbsp;=&nbsp;load&nbsp;i8**,&nbsp;i8***&nbsp;%<span class="hljs-number">2</span>,&nbsp;align&nbsp;<span class="hljs-number">8</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">37</span><br>&nbsp;&nbsp;store&nbsp;i8*&nbsp;%<span class="hljs-number">16</span>,&nbsp;i8**&nbsp;%<span class="hljs-number">17</span>,&nbsp;align&nbsp;<span class="hljs-number">8</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">38</span><br><br>&nbsp;&nbsp;;&nbsp;加载&nbsp;%<span class="hljs-number">7</span>&nbsp;指针的值<br>&nbsp;&nbsp;%<span class="hljs-number">24</span>&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%<span class="hljs-number">7</span>,&nbsp;align&nbsp;<span class="hljs-number">8</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">53</span><br>&nbsp;&nbsp;;&nbsp;准备&nbsp;memcpy&nbsp;操作的目标指针<br>&nbsp;&nbsp;%<span class="hljs-number">23</span>&nbsp;=&nbsp;getelementptr&nbsp;inbounds&nbsp;[<span class="hljs-number">100</span>&nbsp;x&nbsp;i8],&nbsp;[<span class="hljs-number">100</span>&nbsp;x&nbsp;i8]*&nbsp;%<span class="hljs-number">8</span>,&nbsp;i32&nbsp;<span class="hljs-number">0</span>,&nbsp;i32&nbsp;<span class="hljs-number">0</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">54</span><br>&nbsp;&nbsp;;&nbsp;执行&nbsp;memcpy&nbsp;操作，从源数组复制<span class="hljs-number">100</span>字节到目标缓冲区<br>&nbsp;&nbsp;;&nbsp;这将导致栈溢出，因为目标缓冲区只有<span class="hljs-number">99</span>字节<br>&nbsp;&nbsp;call&nbsp;void&nbsp;@llvm.memcpy.p0i8.p0i8.i64(i8*&nbsp;%<span class="hljs-number">22</span>,&nbsp;i8*&nbsp;%<span class="hljs-number">23</span>,&nbsp;i64&nbsp;<span class="hljs-number">100</span>,&nbsp;i32&nbsp;<span class="hljs-number">1</span>,&nbsp;i1&nbsp;false),&nbsp;!dbg&nbsp;!<span class="hljs-number">54</span><br><br>&nbsp;&nbsp;;&nbsp;加载目标指针<br>&nbsp;&nbsp;%<span class="hljs-number">26</span>&nbsp;=&nbsp;load&nbsp;i8*,&nbsp;i8**&nbsp;%<span class="hljs-number">7</span>,&nbsp;align&nbsp;<span class="hljs-number">8</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">57</span><br>&nbsp;&nbsp;;&nbsp;获取目标缓冲区最后一字节的地址<br>&nbsp;&nbsp;%<span class="hljs-number">25</span>&nbsp;=&nbsp;getelementptr&nbsp;inbounds&nbsp;i8,&nbsp;i8*&nbsp;%<span class="hljs-number">24</span>,&nbsp;i64&nbsp;<span class="hljs-number">99</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">55</span><br>&nbsp;&nbsp;;&nbsp;在最后一个地址存储一个空字符以结束复制的数据<br>&nbsp;&nbsp;store&nbsp;i8&nbsp;<span class="hljs-number">0</span>,&nbsp;i8*&nbsp;%<span class="hljs-number">25</span>,&nbsp;align&nbsp;<span class="hljs-number">1</span>,&nbsp;!dbg&nbsp;!<span class="hljs-number">56</span><br><br>&nbsp;&nbsp;;&nbsp;调用一个打印缓冲区内容的函数（这个函数调用可能是一个漏洞）<br>&nbsp;&nbsp;call&nbsp;void&nbsp;@printLine(i8*&nbsp;%<span class="hljs-number">26</span>),&nbsp;!dbg&nbsp;!<span class="hljs-number">58</span><br><br>&nbsp;&nbsp;;&nbsp;函数返回，无返回值<br>&nbsp;&nbsp;ret&nbsp;void,&nbsp;!dbg&nbsp;!<span class="hljs-number">59</span><br>}<br></code></pre>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/510362ac-eaac-4e9f-8b2c-672e1a63f251.png" alt=""></figure>
<p data-tool="mdnice编辑器">(4). autoReorder.py</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器">
<p>python2 autoRecorder.py ../../000/</p>
</blockquote>
<p data-tool="mdnice编辑器">此文件用于对从源代码文件中提取的语句进行重新排序。输出是 newslice 目录下的 .final.ll 文件，这是一个 llvm 切片。</p>
<p data-tool="mdnice编辑器">修改源代码中<strong>autoReorder</strong>.py 为<strong>autoRecorder</strong>.py</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/cc85f81b-74fa-4e95-93b6-ce9b44b4c129.png" alt=""></figure>
<p data-tool="mdnice编辑器">(5). getFlawLoc.py</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器">
<p>python2 getFlawLoc.py ../../000/</p>
</blockquote>
<p data-tool="mdnice编辑器">此文件用于获取 slice2flawline.pkl，其中包含易受攻击的行号。</p>
<p data-tool="mdnice编辑器">(6). addFlawtag.py</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器">
<p>python addFlawtag.py SARD-hole_line.txt</p>
</blockquote>
<p data-tool="mdnice编辑器">此文件用于获取 newslice 目录下 llvm 切片对应的源代码切片 （.slicer.c）</p>
<p data-tool="mdnice编辑器">(7). getSourceLine.py</p>
<blockquote class="multiquote-1" data-tool="mdnice编辑器">
<p>python getSourceLine.py ../../000/</p>
</blockquote>
<p data-tool="mdnice编辑器">此文件用于 slice2flawline.pkl，其中包含对应于 .slicer.c 文件的易受攻击行的行号</p>
<h2 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">Step 2: Data preprocess</span><span class="suffix"></span></h2>
<ol data-tool="mdnice编辑器">
<li><section>process_dataflow.py: Get the corpus of slices generated from the systhetic and academic dataset.
process_dataflow_NVD.py: Get the corpus of slices generated from the real-world dataset.
The input is slices generated from the systhetic and academic dataset and the real-world dataset and the output is corpus files.
获取从系统和学术数据集生成的切片语料库。 process_dataflow_NVD.py：获取从真实数据集生成的切片语料库。 输入是从系统和学术数据集以及真实世界数据集生成的切片，输出是语料库文件。</section></li></ol>
<p data-tool="mdnice编辑器">这里需要修改很多地方</p>
<p data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/1ca89f80-4c27-4c9b-b019-0740a8eda7e9.jpg" alt="">
将000文件夹移动到\src\data_preprocess\data\SARD\data_source\xxx下，这里的xxx自己取。</p>
<p data-tool="mdnice编辑器">将getllvm..目录下的slice2flawline_NO.pkl移动到src\data_preprocess\data\SARD\label_source目录下，并修改文件名为xxx_Flawline.pkl，主要原因如下：</p>
<p data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/8882120f-df1b-465b-9aa5-c37ec38be3fe.png" alt="">
然后corpus目录下就出现了</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/d8961752-2c11-4102-8bea-c9484ff17e75.png" alt=""></figure>
<ol start="2" data-tool="mdnice编辑器">
<li><section>create_word2vecmodel.py: Train the word2vec model. The input is the corpus files and the output is the trained model.
训练 word2vec 模型。输入是语料库文件，输出是经过训练的模型。</section></li></ol>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/04d6cd94-c660-4b83-808d-4b115fc4ad67.png" alt=""></figure>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/b79b228f-f562-4d7c-ae0e-995df4b28449.png" alt=""></figure>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/d0c06376-1df5-4fa7-9440-9393f74f6538.png" alt=""></figure>
<ol start="3" data-tool="mdnice编辑器">
<li><section>get_dl_input.py. Get the vectors of tokens in the corpus files. The input is the corpus file and the trained word2vec model and the output is the vector file.
获取语料库文件中标记的向量。输入是语料库文件和经过训练的 word2vec 模型，输出是向量文件。</section></li></ol>
<p data-tool="mdnice编辑器">要注意修改py文件缩进要用空格，因为源代码用的就是空格spqce</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/5d583714-9a53-43e2-b3c4-1717fa9e0c08.png" alt=""></figure>
<p data-tool="mdnice编辑器">train</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/0bac2afe-1fb3-40f2-86a1-f63dab167faf.png" alt=""></figure>
<p data-tool="mdnice编辑器">test</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/b90852a7-058b-42c8-bdaf-b303131bbcc1.png" alt=""></figure>
<h2 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">Step 3: Model training</span><span class="suffix"></span></h2>
<ol data-tool="mdnice编辑器">
<li><section>bgru_threshold.py: Train the BGRU model which can locate the vulnerabilities and evaluate it. The input is the training dataset and the test dataset, and the output is the trained BGRU model.</section></li></ol>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/6b8b9f20-aa6b-415c-a12b-422de06b2264.png" alt=""></figure>
<p data-tool="mdnice编辑器">conda安装cuda-cudnn-pytorch参考：</p>
<p data-tool="mdnice编辑器">gpu调用成功</p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/c368591d-f915-4f27-a44b-5c566b228afb.png" alt=""></figure>
<ol start="2" data-tool="mdnice编辑器">
<li><section>bgru_raw.py: Train the original BGRU model.</section></li></ol>
<p data-tool="mdnice编辑器">process_dataflow.py：获取从系统和学术数据集生成的切片语料库。</p>
<p data-tool="mdnice编辑器">注意程序中</p>
<p data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/18d08d7f-ccda-42be-96c8-f06a780fae12.png" alt="">
这里是有s的</p>
<p data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/170d4b42-2b1e-4f22-9550-e3d9e6ef48ca.png" alt="">
但是github的源码文件夹没有s，需要在synthetic and academic dataset后面加个s。</p>
<h2 data-tool="mdnice编辑器"><span class="prefix"></span><span class="content">结果</span><span class="suffix"></span></h2>
<p data-tool="mdnice编辑器">第一次</p>
<pre class="custom" data-tool="mdnice编辑器"><code class="hljs">(VDL)&nbsp;root@cloud:/home/cloud/WORK/2024/03/src<span class="hljs-comment">#&nbsp;python&nbsp;bgru_threshold.py</span><br>Using&nbsp;TensorFlow&nbsp;backend.<br>/root/anaconda3/envs/VDL/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517:&nbsp;FutureWarning:&nbsp;Passing&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;1)&nbsp;or&nbsp;<span class="hljs-string">'1type'</span>&nbsp;as&nbsp;a&nbsp;synonym&nbsp;of&nbsp;<span class="hljs-built_in">type</span>&nbsp;is&nbsp;deprecated;&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version&nbsp;of&nbsp;numpy,&nbsp;it&nbsp;will&nbsp;be&nbsp;understood&nbsp;as&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;(1,))&nbsp;/&nbsp;<span class="hljs-string">'(1,)type'</span>.<br>&nbsp;&nbsp;_np_qint8&nbsp;=&nbsp;np.dtype([(<span class="hljs-string">"qint8"</span>,&nbsp;np.int8,&nbsp;1)])<br>/root/anaconda3/envs/VDL/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518:&nbsp;FutureWarning:&nbsp;Passing&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;1)&nbsp;or&nbsp;<span class="hljs-string">'1type'</span>&nbsp;as&nbsp;a&nbsp;synonym&nbsp;of&nbsp;<span class="hljs-built_in">type</span>&nbsp;is&nbsp;deprecated;&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version&nbsp;of&nbsp;numpy,&nbsp;it&nbsp;will&nbsp;be&nbsp;understood&nbsp;as&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;(1,))&nbsp;/&nbsp;<span class="hljs-string">'(1,)type'</span>.<br>&nbsp;&nbsp;_np_quint8&nbsp;=&nbsp;np.dtype([(<span class="hljs-string">"quint8"</span>,&nbsp;np.uint8,&nbsp;1)])<br>/root/anaconda3/envs/VDL/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519:&nbsp;FutureWarning:&nbsp;Passing&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;1)&nbsp;or&nbsp;<span class="hljs-string">'1type'</span>&nbsp;as&nbsp;a&nbsp;synonym&nbsp;of&nbsp;<span class="hljs-built_in">type</span>&nbsp;is&nbsp;deprecated;&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version&nbsp;of&nbsp;numpy,&nbsp;it&nbsp;will&nbsp;be&nbsp;understood&nbsp;as&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;(1,))&nbsp;/&nbsp;<span class="hljs-string">'(1,)type'</span>.<br>&nbsp;&nbsp;_np_qint16&nbsp;=&nbsp;np.dtype([(<span class="hljs-string">"qint16"</span>,&nbsp;np.int16,&nbsp;1)])<br>/root/anaconda3/envs/VDL/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520:&nbsp;FutureWarning:&nbsp;Passing&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;1)&nbsp;or&nbsp;<span class="hljs-string">'1type'</span>&nbsp;as&nbsp;a&nbsp;synonym&nbsp;of&nbsp;<span class="hljs-built_in">type</span>&nbsp;is&nbsp;deprecated;&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version&nbsp;of&nbsp;numpy,&nbsp;it&nbsp;will&nbsp;be&nbsp;understood&nbsp;as&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;(1,))&nbsp;/&nbsp;<span class="hljs-string">'(1,)type'</span>.<br>&nbsp;&nbsp;_np_quint16&nbsp;=&nbsp;np.dtype([(<span class="hljs-string">"quint16"</span>,&nbsp;np.uint16,&nbsp;1)])<br>/root/anaconda3/envs/VDL/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:521:&nbsp;FutureWarning:&nbsp;Passing&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;1)&nbsp;or&nbsp;<span class="hljs-string">'1type'</span>&nbsp;as&nbsp;a&nbsp;synonym&nbsp;of&nbsp;<span class="hljs-built_in">type</span>&nbsp;is&nbsp;deprecated;&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version&nbsp;of&nbsp;numpy,&nbsp;it&nbsp;will&nbsp;be&nbsp;understood&nbsp;as&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;(1,))&nbsp;/&nbsp;<span class="hljs-string">'(1,)type'</span>.<br>&nbsp;&nbsp;_np_qint32&nbsp;=&nbsp;np.dtype([(<span class="hljs-string">"qint32"</span>,&nbsp;np.int32,&nbsp;1)])<br>/root/anaconda3/envs/VDL/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:526:&nbsp;FutureWarning:&nbsp;Passing&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;1)&nbsp;or&nbsp;<span class="hljs-string">'1type'</span>&nbsp;as&nbsp;a&nbsp;synonym&nbsp;of&nbsp;<span class="hljs-built_in">type</span>&nbsp;is&nbsp;deprecated;&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version&nbsp;of&nbsp;numpy,&nbsp;it&nbsp;will&nbsp;be&nbsp;understood&nbsp;as&nbsp;(<span class="hljs-built_in">type</span>,&nbsp;(1,))&nbsp;/&nbsp;<span class="hljs-string">'(1,)type'</span>.<br>&nbsp;&nbsp;np_resource&nbsp;=&nbsp;np.dtype([(<span class="hljs-string">"resource"</span>,&nbsp;np.ubyte,&nbsp;1)])<br>Build&nbsp;model...<br>WARNING:tensorflow:From&nbsp;/home/cloud/WORK/2024/03/src/keras/backend/tensorflow_backend.py:1364:&nbsp;calling&nbsp;reduce_any&nbsp;(from&nbsp;tensorflow.python.ops.math_ops)&nbsp;with&nbsp;keep_dims&nbsp;is&nbsp;deprecated&nbsp;and&nbsp;will&nbsp;be&nbsp;removed&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version.<br>Instructions&nbsp;<span class="hljs-keyword">for</span>&nbsp;updating:<br>keep_dims&nbsp;is&nbsp;deprecated,&nbsp;use&nbsp;keepdims&nbsp;instead<br>WARNING:tensorflow:From&nbsp;/home/cloud/WORK/2024/03/src/keras/backend/tensorflow_backend.py:1247:&nbsp;calling&nbsp;reduce_sum&nbsp;(from&nbsp;tensorflow.python.ops.math_ops)&nbsp;with&nbsp;keep_dims&nbsp;is&nbsp;deprecated&nbsp;and&nbsp;will&nbsp;be&nbsp;removed&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version.<br>Instructions&nbsp;<span class="hljs-keyword">for</span>&nbsp;updating:<br>keep_dims&nbsp;is&nbsp;deprecated,&nbsp;use&nbsp;keepdims&nbsp;instead<br>WARNING:tensorflow:From&nbsp;/home/cloud/WORK/2024/03/src/keras/backend/tensorflow_backend.py:1349:&nbsp;calling&nbsp;reduce_mean&nbsp;(from&nbsp;tensorflow.python.ops.math_ops)&nbsp;with&nbsp;keep_dims&nbsp;is&nbsp;deprecated&nbsp;and&nbsp;will&nbsp;be&nbsp;removed&nbsp;<span class="hljs-keyword">in</span>&nbsp;a&nbsp;future&nbsp;version.<br>Instructions&nbsp;<span class="hljs-keyword">for</span>&nbsp;updating:<br>keep_dims&nbsp;is&nbsp;deprecated,&nbsp;use&nbsp;keepdims&nbsp;instead<br>begin&nbsp;compile<br>__________________________________________________________________________________________________<br>Layer&nbsp;(<span class="hljs-built_in">type</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Output&nbsp;Shape&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Param&nbsp;<span class="hljs-comment">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connected&nbsp;to</span><br>==================================================================================================<br>input_1&nbsp;(InputLayer)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;30)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>__________________________________________________________________________________________________<br>mask_1&nbsp;(Masking)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;30)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_1[0][0]<br>__________________________________________________________________________________________________<br>bgru_1&nbsp;(Bidirectional)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;1024)&nbsp;&nbsp;&nbsp;&nbsp;1668096&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask_1[0][0]<br>__________________________________________________________________________________________________<br>dropout_1&nbsp;(Dropout)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;1024)&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bgru_1[0][0]<br>__________________________________________________________________________________________________<br>bgru_2&nbsp;(Bidirectional)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;1024)&nbsp;&nbsp;&nbsp;&nbsp;4721664&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dropout_1[0][0]<br>__________________________________________________________________________________________________<br>dropout_2&nbsp;(Dropout)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;1024)&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bgru_2[0][0]<br>__________________________________________________________________________________________________<br>dense1&nbsp;(TimeDistributed)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1025&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dropout_2[0][0]<br>__________________________________________________________________________________________________<br>activation_1&nbsp;(Activation)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dense1[0][0]<br>__________________________________________________________________________________________________<br>vulner_mask_input&nbsp;(InputLayer)&nbsp;&nbsp;(None,&nbsp;900,&nbsp;900)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br>__________________________________________________________________________________________________<br>non_masking_1&nbsp;(NonMasking)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;activation_1[0][0]<br>__________________________________________________________________________________________________<br>multiply_1&nbsp;(Multiply)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;900,&nbsp;900)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vulner_mask_input[0][0]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;non_masking_1[0][0]<br>__________________________________________________________________________________________________<br>reshape_1&nbsp;(Reshape)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;1,&nbsp;810000)&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiply_1[0][0]<br>__________________________________________________________________________________________________<br>k_max_1&nbsp;(KMaxPooling)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(None,&nbsp;1,&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reshape_1[0][0]<br>__________________________________________________________________________________________________<br>average_1&nbsp;(GlobalAveragePooling&nbsp;(None,&nbsp;1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k_max_1[0][0]<br>==================================================================================================<br>Total&nbsp;params:&nbsp;6,390,785<br>Trainable&nbsp;params:&nbsp;6,390,785<br>Non-trainable&nbsp;params:&nbsp;0<br>__________________________________________________________________________________________________<br>Loading&nbsp;data...<br>train_1_0818.pkl<br>train_3_0818.pkl<br>train_2_0818.pkl<br>train_0_0818.pkl<br>train_4_0818.pkl<br>train_5_0818.pkl<br>60859<br>Train...<br>Epoch&nbsp;1/4<br>2024-03-18&nbsp;01:20:28.271197:&nbsp;I&nbsp;tensorflow/core/platform/cpu_feature_guard.cc:140]&nbsp;Your&nbsp;CPU&nbsp;supports&nbsp;instructions&nbsp;that&nbsp;this&nbsp;TensorFlow&nbsp;binary&nbsp;was&nbsp;not&nbsp;compiled&nbsp;to&nbsp;use:&nbsp;SSE4.1&nbsp;SSE4.2<br>2024-03-18&nbsp;01:20:29.555945:&nbsp;I&nbsp;tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898]&nbsp;successful&nbsp;NUMA&nbsp;node&nbsp;<span class="hljs-built_in">read</span>&nbsp;from&nbsp;SysFS&nbsp;had&nbsp;negative&nbsp;value&nbsp;(-1),&nbsp;but&nbsp;there&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;one&nbsp;NUMA&nbsp;node,&nbsp;so&nbsp;returning&nbsp;NUMA&nbsp;node&nbsp;zero<br>2024-03-18&nbsp;01:20:29.556830:&nbsp;I&nbsp;tensorflow/core/common_runtime/gpu/gpu_device.cc:1212]&nbsp;Found&nbsp;device&nbsp;0&nbsp;with&nbsp;properties:<br>name:&nbsp;NVIDIA&nbsp;GeForce&nbsp;RTX&nbsp;2080&nbsp;Ti&nbsp;major:&nbsp;7&nbsp;minor:&nbsp;5&nbsp;memoryClockRate(GHz):&nbsp;1.545<br>pciBusID:&nbsp;0000:01:00.0<br>totalMemory:&nbsp;10.76GiB&nbsp;freeMemory:&nbsp;10.61GiB<br>2024-03-18&nbsp;01:20:29.556877:&nbsp;I&nbsp;tensorflow/core/common_runtime/gpu/gpu_device.cc:1312]&nbsp;Adding&nbsp;visible&nbsp;gpu&nbsp;devices:&nbsp;0<br>2024-03-18&nbsp;01:20:29.862770:&nbsp;I&nbsp;tensorflow/core/common_runtime/gpu/gpu_device.cc:993]&nbsp;Creating&nbsp;TensorFlow&nbsp;device&nbsp;(/job:localhost/replica:0/task:0/device:GPU:0&nbsp;with&nbsp;10253&nbsp;MB&nbsp;memory)&nbsp;-&gt;&nbsp;physical&nbsp;GPU&nbsp;(device:&nbsp;0,&nbsp;name:&nbsp;NVIDIA&nbsp;GeForce&nbsp;RTX&nbsp;2080&nbsp;Ti,&nbsp;pci&nbsp;bus&nbsp;id:&nbsp;0000:01:00.0,&nbsp;compute&nbsp;capability:&nbsp;7.5<br>950/950&nbsp;[==============================]&nbsp;-&nbsp;5091s&nbsp;5s/step&nbsp;-&nbsp;loss:&nbsp;0.2346&nbsp;-&nbsp;TP_count:&nbsp;1.9284&nbsp;-&nbsp;FP_count:&nbsp;0.8095&nbsp;-&nbsp;FN_count:&nbsp;5.3253&nbsp;-&nbsp;precision:&nbsp;0.3146&nbsp;-&nbsp;recall:&nbsp;0.2630&nbsp;-&nbsp;fbeta_score:&nbsp;0.2694&nbsp;ETA:&nbsp;14:17&nbsp;-&nbsp;loss:&nbsp;0.2581&nbsp;-&nbsp;TP_count:&nbsp;1.2494&nbsp;-&nbsp;FP_count:&nbsp;0.7025&nbsp;-&nbsp;FN_count:&nbsp;6.0241&nbsp;-&nbsp;precision:&nbsp;0.2162Epoch&nbsp;2/41675&nbsp;-&nbsp;fbeta_score:&nbsp;0.17431499<br>950/950&nbsp;[==============================]&nbsp;-&nbsp;5087s&nbsp;5s/step&nbsp;-&nbsp;loss:&nbsp;0.0941&nbsp;-&nbsp;TP_count:&nbsp;5.8947&nbsp;-&nbsp;FP_count:&nbsp;1.1053&nbsp;-&nbsp;FN_count:&nbsp;1.3589&nbsp;-&nbsp;precision:&nbsp;0.8-&nbsp;recall:&nbsp;0.8083&nbsp;-&nbsp;fbeta_score:&nbsp;0.8045657<br>950/950&nbsp;[==============================]&nbsp;-&nbsp;5089s&nbsp;5s/step&nbsp;-&nbsp;loss:&nbsp;0.0652&nbsp;-&nbsp;TP_count:&nbsp;6.3674&nbsp;-&nbsp;FP_count:&nbsp;0.8021&nbsp;-&nbsp;FN_count:&nbsp;0.8863&nbsp;-&nbsp;precision:&nbsp;0.8-&nbsp;recall:&nbsp;0.8735&nbsp;-&nbsp;fbeta_score:&nbsp;0.86686&nbsp;&nbsp;-&nbsp;ETA:&nbsp;1:06:26&nbsp;-&nbsp;loss:&nbsp;0.0760&nbsp;-&nbsp;TP_count:&nbsp;6.4433&nbsp;-&nbsp;FP_count:&nbsp;0.9212&nbsp;-&nbsp;FN_count:&nbsp;1.0837&nbsp;-&nbsp;precision:&nbsp;0.88<br>950/950&nbsp;[==============================]&nbsp;-&nbsp;5087s&nbsp;5s/step&nbsp;-&nbsp;loss:&nbsp;0.0445&nbsp;-&nbsp;TP_count:&nbsp;6.7379&nbsp;-&nbsp;FP_count:&nbsp;0.5611&nbsp;-&nbsp;FN_count:&nbsp;0.5158&nbsp;-&nbsp;precision:&nbsp;0.9209&nbsp;-&nbsp;recall:&nbsp;0.9220&nbsp;-&nbsp;fbeta_score:&nbsp;0.9116&nbsp;ETA:&nbsp;9:37&nbsp;-&nbsp;loss:&nbsp;0.0453&nbsp;-&nbsp;TP_count:&nbsp;6.7530&nbsp;-&nbsp;FP_count:&nbsp;0.5831&nbsp;-&nbsp;FN_count:&nbsp;0.5238&nbsp;-&nbsp;precision:&nbsp;0.9180&nbsp;Test....9202&nbsp;-&nbsp;fbeta_score:&nbsp;0.9091<br>test_5_0124.pkl<br>test_0_0124.pkl<br>test_1_0124.pkl<br>test_3_0124.pkl<br>test_2_0124.pkl<br>test_4_0124.pkl<br>17959&nbsp;17959<br>&nbsp;0&nbsp;/&nbsp;280Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):<br>&nbsp;&nbsp;File&nbsp;<span class="hljs-string">"bgru_threshold.py"</span>,&nbsp;line&nbsp;437,&nbsp;<span class="hljs-keyword">in</span>&nbsp;&lt;module&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;main(traindataSetPath,&nbsp;testdataSetPath,&nbsp;weightPath,&nbsp;resultPath,&nbsp;batchSize,&nbsp;maxLen,&nbsp;vectorDim,&nbsp;dropout=dropout)<br>&nbsp;&nbsp;File&nbsp;<span class="hljs-string">"bgru_threshold.py"</span>,&nbsp;line&nbsp;288,&nbsp;<span class="hljs-keyword">in</span>&nbsp;main<br>&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;open(<span class="hljs-string">"result_analyze/TP/"</span>+str(index)+<span class="hljs-string">".pkl"</span>,<span class="hljs-string">"wb"</span>)&nbsp;as&nbsp;f:<br>FileNotFoundError:&nbsp;[Errno&nbsp;2]&nbsp;No&nbsp;such&nbsp;file&nbsp;or&nbsp;directory:&nbsp;<span class="hljs-string">'result_analyze/TP/0.pkl'</span><br><br></code></pre>
<p data-tool="mdnice编辑器">这里的报错是因为没有TP目录，创建目录后重新训练和测试。</p>
<p data-tool="mdnice编辑器"><strong>最终结果</strong></p>
<figure data-tool="mdnice编辑器"><img src="https://files.mdnice.com/user/53147/78ac2162-3d60-4d96-9004-122d040ae20e.png" alt=""></figure>
<br data-tool="mdnice编辑器">
<p style="text-align:center;font-size:20px;font-weight:bold" data-tool="mdnice编辑器"> - END - </p>
<hr data-tool="mdnice编辑器">
<section class="block-2" data-tool="mdnice编辑器"><section class="block-2-inner"><p><strong>一个只记录最真实学习网络安全历程的小木屋，最新文章会在公众号更新，欢迎各位师傅关注！<br>
公众号名称：奇怪小木屋</strong><br>
<img src="https://img-blog.csdnimg.cn/img_convert/b2899406330f7cd3c766a74eba75fb0f.jpeg" width="200" height="200" alt="图片名称" align="center"><br>
博客园主页：
<a href="https://www.cnblogs.com/Zyecho/">博客园-我记得</a>https://www.cnblogs.com/Zyecho/</p>
</section></section></section>