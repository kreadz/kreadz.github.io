## 研究现状
根据论文：**基于图神经网络的切片级漏洞检测及解释方法**[doi: 10.13328/j.cnki.jos.006849] 来看

当前基于图神经网络的漏洞检测方法，图比文本能够更好地表达代码的结构和语义信息, 因此在漏洞检测领域, 基于图模型的检测方式效果明 显优于基于文本模型的检测方式.

## 基础知识
基于深度学习的源代码漏洞检测领域的过去工作主要可以分为4类，相当于对4种不同类型的代码表征进行学习：基于图的表征、基于序列的表征、基于text的表征、混合表征。(from Software Vulnerability Detection Using Deep Neural Networks: A Survey)

当前漏洞检测属于静态检测，讲一讲静态程序分析和图神经网络的相关概念

### 程序静态分析相关概念 
程序静态分析方法主要基于代码抽象语法树、控制流图、程序依赖图等代码表征图, 相关概念介绍如下. 

- 抽象语法树(abstract syntax tree, AST): AST 是一种树形结构的源代码抽象表示, 其从根节点开始, 将 代码依次分解为代码块、语句、声明、表达式等. AST 主要用于描述代码的语法结构, 是构成其他代 码表征图的基础; 

- 控制流图(control flow graph, CFG): CFG 是一种有向图, 其节点表示函数语句, 边则表示相邻语句间 运行的先后关系, 描述了程序在执行过程中可能经过的所有运行路径; 

- 数据依赖: 设 A 和 B 是两个代码语句, 若 A 语句中计算得到的变量在 B 语句中使用, 则称 B 语句数据 依赖于 A 语句;  控制依赖: 设 A 和 B 是两个代码语句, 若 B 语句能否执行取决于 A 语句执行的结果, 则称 B 语句控制 依赖于 A 语句; 

- 程序依赖图(program dependence graph, PDG): PDG 是一种带有标记的有向多重图, 其基于 AST 的节 点构建, 节点表示代码语句, 边表示相邻节点存在数据依赖或控制依赖关系; 

- 代码属性图(code property graph, CPG): CPG 将 AST、CFG 和 PDG 整合至一种数据结构, 其包含源代 码中的所有语法特征和语义特征; 

- 代码切片: 代码切片由彼此之间具有数据依赖或控制依赖关系的语句构成

### 图神经网络

基于图神经网络的漏洞检测属于**图级别任务**, 其 目的是判断输入的代码表征图是否存在漏洞。

目前, 图神经网络根据模型类型主要分为以下 3 种.

- 图卷积网络(graph convolutional network, GCN): GCN 将卷积运算推广到图数据, 其核心思想在于学 习一个函数映射, 通过该映射, 可以聚合图中节点及其邻居节点特征, 从而生成该节点的新表示. 卷 积运算又可以具体分为基于谱的方法和基于空间的方法, 其中, 基于谱的方法在训练时需要将全图 加载入内存, 因此在处理复杂图时性能较差; 由于基于空间的图卷积方法的中心节点、感受域和聚合 函数不确定, 导致相互制约依赖, 实际使用效果不佳;

- 图注意力网络(graph attention network, GAT): GAT 在 GNN 上引入注意力机制, 在聚合过程使用注意 力关注对任务有影响的邻居节点信息, 进而为节点分配权重, 使得 GNN 重点关注与任务相关的节点 和边, 以提升模型效果. 但其增加了计算邻居之间注意权重的时间开销和内存消耗, 同时, 注意力机 制的实际作用又与网络初始化相关; 

- 图循环网络(graph recurrent network, GRN): GRN 将图转换为序列, 使用长短期记忆网络(long shortterm memory, LSTM)或门控循环单元(gated recurrent unit, GRU)等循环神经网络作为架构训练. 相比 于其他 GNN 模型, GRN 在信息传递过程中使用门控机制, 可以提高在整个图上的长期信息传播能力 及模型表征能力. 门控图神经网络(gated graph neural network, GGNN)模型即为 GRN 类型下的一种网络结构.

## 当前流行方法

### 1. 图提取
Joern
LLVM-IR

- 双重特征（源代码+LLVM中间代码“Automated software vulnerability detection with machine learning,” 2018, arXiv:1803.04497. [Online]. Available: http://arxiv.org/abs/1803.04497）

### 2. 图嵌入
word2vec、sent2vec

- 作者对APK文件进行反编译，得到smali文件和dalvik指令，从smali文件中得到两种类型的特征：由dalvik指令的频率所显示的token特征，以及由smali文件的AST生成的语义特征。AST中语义特征的获取作者采用了DFS遍历AST生成AST序列，将序列通过编码token频率特征的方式来embedding，最后将两种类型的特征混合后输入FCN进行训练检测。(F.Dong,J.Wang,Q.Li,G.Xu,andS.Zhang, “Defect prediction in Android binary executables using deep neural network,” Wireless Pers. Commun., vol. 102, no. 3, pp. 2261–2285, Oct. 2018)



#### word2vec
word2vec模型提出了instruction2vec方法

### 3. 训练网络

漏洞分类模块的核心思想在于: 选择与漏洞特征相关的特征集合, 以完成图级别的漏洞样本分类任务. 先前的工作[36]提出: 在图卷积层后使用一个分类池化层(SortPooling), 从而实现对图卷积层输出特征的排序, 即可输入传统的神经网络对其进行训练, 以提取切片向量嵌入中的有用特征.

#### attention机制


## 数据集

数据集是阻碍该领域研究的最大障碍，目前该领域的研究方法普遍采用自己构建的数据集，因为不同的方法对应不同的检测粒度，对应的标签也就不同。因此，迫切需要一个标准的基准数据集，作为评估和比较所提出方法有效性的统一度量标准。[58]是第一个提出这种基准数据集的工作，提出了一个包含9个数据集的开源C代码，包含函数和文件两个检测粒度。理想情况下，标准的基准测试数据集应该针对多个检测粒度级别的方法进行精心定制，并且应该包含大量的合成和真实代码示例，以便进行定性和定量的评估和比较。上图列出了现有的开源代码real-world漏洞数据集，然而这些数据集很多数量不足，标记量不足，存在各种各样的问题
![](https://img-blog.csdnimg.cn/img_convert/4921daddd533eae7de44f1f8a4a7e77d.png)

